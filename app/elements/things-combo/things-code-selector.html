<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="./things-combo.html">

<dom-module id="things-code-selector">
	<template>
    <!--paper-dropdown-menu id="combo" label="Language" value="{{value}}">
      <paper-menu class="dropdown-content" selected="{{findSelected(value)}}">
        <template is="dom-repeat" items="{{items}}">
          <paper-item value="{{item.name}}">{{item.description}}</paper-item>
        </template>
      </paper-menu>
    </paper-dropdown-menu-->

    <things-combo id="combo"></things-combo>

    <things-resource
      auto
      id="resource" 
      action="{{computeUrl(name)}}" 
      method="GET" 
      root-property="items"
      outout-data="{{items}}">
    </things-resource>

	</template>

  <script type="text/javascript">
  	(function() {
      Polymer({
        is: "things-code-selector",

        properties: {
          name: {
            type: String,
            notify: true
          },

          items: {
            type: Array,
            value: []
          },

          value: {
            type: String,
            value: 'zh-CN'
          }

        },

        listeners: {
          'combo.iron-select' : 'onComboSelected',
          'combo.iron-deselect' : 'onComboDeselected',          
          'resource.response' : 'onResponse'
        },

        computeUrl: function(code) {
          return 'common_codes/show_by_name?name=' + code;
        },

        findSelected: function (value) {
          for(var i = 0; i < this.items.length; i++) {
            if(this.items[i].value == value) {
              return i;
            }
          }

          return 0;
        },

        onResponse: function(e) {
          console.log(e);
          this.items = e.detail;
        },

        onComboSelected: function(e) {
          this.fire('select', { name : e.detail.item.value, description : e.detail.item.textContent });
        },

        onComboDeselected: function(e) {
          this.fire('deselect', { name : e.detail.item.value, description : e.detail.item.textContent });
        }        

      })
  	})();
  </script>
</dom-module>
