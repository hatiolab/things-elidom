<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../../../bower_components/paper-toolbar/paper-toolbar.html">

<link rel="import" href="../things-paginator/things-paginator.html">
<link rel="import" href="./things-grid-basic-behavior.html">

<!--
기본 그리드. 그리드 데이터를 표시하기만 하는 그리드

pagination을 지원하고 데이터를 표시한 후 저장이나 삭제 등의 트랜잭션 기능은 없다.

	Example:

	  <things-resource 
	    auto
	    action="diy_services/ElidomGridModel/query.json" 
	    last-response="{{gridModel}}">
	  </things-resource>

	  <things-resource 
	    auto
	    action="diy_services/ElidomGridColumn/query.json" 
	    last-response="{{gridColumns}}">
	  </things-resource>

	  <things-resource 
	    id="search-resource"
	    action="terminologies" 
	    method="GET"
	    last-response="{{gridData}}">
	  </things-resource>

	  <things-basic-grid 
	    id="grid"
	    grid-model="[[gridModel]]" 
	    columns="[[gridColumns]]" 
	    read-data="[[gridData]]"
	    page="{{page}}"
	    limit="{{limit}}"
	    root-property="items"
	    total-property="total"
	    selected-row-data="{{selectedRow}}"
	    page-start-idx="{{pageStartIdx}}"
	    page-end-idx="{{pageEndIdx}}">
	  </things-basic-grid>

@demo ./things-grid/demo/demo-things-basic-grid.html
-->

<dom-module id="things-basic-grid">
	<template>
		<style>
			:host {
				display: block;
				height: 100%;
				width: 100%;
				padding: 10px 0px 0px 0px;
			}
		</style>
	
		<div id="gridContainer"></div>

		<paper-toolbar class="white">
			<div class="bottom fit">
				<things-paginator 
					per-page="{{limit}}" 
					current-page="{{page}}" 
					total-count="{{totalCount}}"
					page-start-idx="{{pageStartIdx}}"
					page-end-idx="{{pageEndIdx}}">
				</things-paginator>
			</div>
		</paper-toolbar>

	</template>

	<script>
		Polymer({
			is: 'things-basic-grid',

			behaviors: [
				Things.GridBasicBehavior
			],
	
			properties: {
				/**
				 * 핸들링하고자 하는 grid event를 설정한다. { grid event 명 : 'event handler 명' }
				 */
				gridEvents : {
					type: Object,
					value: {
						onDataCellClicked : '_gridCellClicked'
					}
				}

				/**
				 * 그리드 Row Data가 선택되었을 경우 fire
				 *
				 * @event things-grid-row-data-select
				 */
				/**
				 * 그리드 Cell Data가 선택되었을 경우 fire
				 *
				 * @event things-grid-cell-data-select
				 */				
			},

			created: function() {
				DataLudi.setRootContext('');
				DataLudi.setAssetRoot('images/grid');
			},

			detached: function() {
				this.clearGrid();
			},

			/**
			 * Dataludi grid cell click 이벤트 핸들러 
			 */
			_gridCellClicked: function(grid, cellData) {
				var thingsGrid = grid._container_;

				if (cellData && cellData.dataColumn() && cellData.getDataIndex(grid) >= 0) {
					var rowIndex = cellData.getDataIndex(grid);
					var colIndex = cellData.dataField();
					var row = grid.focusedRow();

					if (row && row.dataIndex() >= 0) {
						thingsGrid.selectedRowData = row.getRowObject();
						thingsGrid.fire('things-grid-row-data-select', thingsGrid.selectedRowData);
					}

					if(cellData.dataField() >= 0) {
						thingsGrid.selectedCellData = thingsGrid.dataSet.getValue(rowIndex, colIndex);
						thingsGrid.fire('things-grid-cell-data-select', thingsGrid.selectedCellData);
					}
				}
			}

		});
	</script>
</dom-module>