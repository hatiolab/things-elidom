<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../../../bower_components/paper-toolbar/paper-toolbar.html">

<link rel="import" href="../things-paginator/things-paginator.html">
<link rel="import" href="./things-resource-grid.html">

<!--
Diy를 통하여 제공하는 기본 그리드. 그리드 데이터를 표시하기만 하는 그리드

pagination을 지원하고 데이터를 표시한 후 저장이나 삭제 등의 트랜잭션 기능은 없다.

	Example:



@demo ./things-grid/demo/demo-things-diy-grid.html
-->

<dom-module id="things-diy-grid">
	<template>
		<style>
			:host {
				display: block;
				height: 100%;
				width: 100%;
				padding: 10px 0px 0px 0px;
			}
		</style>
		
		<things-resource 
			id="resource-meta"
			auto
			method="GET"
			action="[[resourceMetaUrl]]"
			last-response="{{metaData}}">
		</things-resource>

		<things-resource-grid
			id="grid"
			grid-model="[[metaData.fields]]" 
			columns="[[metaData.columns]]"
			config ="[[metaData.config]]"
			read-data="[[readData]]"
			page="{{page}}"
			limit="{{perPage}}"
			root-property="[[rootProperty]]"
			total-property="[[totalProperty]]"
			read-data="[[lastResponse]]"
			grid-save-action="[[gridSaveUrl]]"
			selected-row-data="{{selectedRow}}"
			export-file-name="[[title]]"
			export-sheet-name="[[title]]"
			readonly = "[[readonly]]"
			enable-detail-column ="[[enableDetailColumn]]"
			enable-check-box ="[[enableCheckBox]]">
		</things-resource-grid>


	</template>

	<script>
		Polymer({
			is: 'things-diy-grid',

			// behaviors: [
			// 	Things.GridBasicBehavior
			// ],
	
			properties: {
				/**
				 * grid name
				 */
				name :{
					type:String
				},
				/**
				 * Boolean need to set false as defualt
				 */
				enableDetailColumn:{
					type:Boolean,
					value:false
				},
				/**
				 * things resource meta url
				 */
				resourceMetaUrl:{
					type:String
				},
				/**
				 * 핸들링하고자 하는 grid event를 설정한다. { grid event 명 : 'event handler 명' }
				 */
				gridEvents : {
					type: Object,
					value: {
						onDataCellClicked : '_gridCellClicked',
						onScrollToBottom :'_gridScrollToBottom'
					}
				}

				/**
				 * 그리드 Row Data가 선택되었을 경우 fire
				 *
				 * @event things-grid-row-data-select
				 */
				/**
				 * 그리드 Cell Data가 선택되었을 경우 fire
				 *
				 * @event things-grid-cell-data-select
				 */				
			},

			created: function() {
				DataLudi.setRootContext('');
				DataLudi.setAssetRoot('../../../images/grid');
			},

			detached: function() {
				this.clearGrid();
			},
			/**
			 * grid 구성 후 추가 액션 
			 */
			afterGridConfigured: function() {
				this.grid.rowIndicator().setStateVisible(true);
				
				if(this.readonly){

					this.grid.setEditOptions({
						readOnly : true
					});

				}else{
					this.grid.setEditOptions({
						deletable: true,
						insertable: true,
						appendable: true,
						updateByCell: true,
						enterToNextRow: true
					});
				}
				// this.grid.editOptions().setUpdateByCell(true);
			},
			/**
			 * Dataludi grid cell click 이벤트 핸들러 
			 */
			_gridCellClicked: function(grid, cellData) {
				var thingsGrid = grid._container_;

				if (cellData && cellData.dataColumn() && cellData.getDataIndex(grid) >= 0) {
					var rowIndex = cellData.getDataIndex(grid);
					var colIndex = cellData.dataField();
					var row = grid.focusedRow();

					if (row && row.dataIndex() >= 0) {
						thingsGrid.selectedRowData = row.getRowObject();
						thingsGrid.fire('things-grid-row-data-select', thingsGrid.selectedRowData);
					}

					if(cellData.dataField() >= 0) {
						thingsGrid.selectedCellData = thingsGrid.dataSet.getValue(rowIndex, colIndex);
						thingsGrid.fire('things-grid-cell-data-select', thingsGrid.selectedCellData);
					}
				}
			},
			/**
			 * Dataludi grid scroll to bottom event handller 
			 * @return {null}
			 */
			_gridScrollToBottom:function(grid){
				console.log('_gridScrollToBottom');
				var thingsGrid = grid.grid._container_;

				this.page +=1;
			}

		});
	</script>
</dom-module>