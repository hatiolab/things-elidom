<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../../bower_components/iron-iconset/iron-iconset.html">
<link rel="import" href="../../../bower_components/iron-iconset-svg/iron-iconset-svg.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../things-button/things-button.html">
<link rel="import" href="../things-combo/things-resource-selector-behavior.html">
<link rel="import" href="../things-grid/things-resource-grid.html">
<link rel="import" href="../things-file-upload/things-file-upload.html">
<link rel="import" href="../things-resource/things-resource.html">

<link rel="import" href="../things-content/things-load-view-behavior.html">
<link rel="import" href="../things-content/things-resource-meta-behavior.html">
<link rel="import" href="../things-content/things-route-content-behavior.html">
<link rel="import" href="../things-msg-box/things-msgbox-behavior.html">
<link rel="import" href="../things-setting/things-global-behavior.html">

<dom-module id="things-attached-file">
  <template>
    <div class="[[layout]]">
      <things-resource 
        id="resourceSearch"
        method="GET"
        content-type="application/x-www-form-urlencoded"
        resource="[[gridSearchUrl]]"
        query-fields="[[queryFields]]"
        last-response="{{lastResponse}}">
      </things-resource>

      <things-resource-grid 
        id="grid"
        config="[[gridConfig]]"
        model="[[gridModel]]" 
        columns="[[gridColumns]]"
        data="[[lastResponse]]"
        enable-detail-column
        enable-toolbar>
      </things-resource-grid>
      
    </div>

    <div>
      <paper-button raised dialog-confirm on-tap="generateRequest">Search</paper-button>
    </div>

  </template>

  <script>    
    Polymer({
      is: 'things-attached-file',

      behaviors: [
        Things.MsgBoxBehavior
      ],

      properties: {
        type: {
          type: String
        },

        id: {
          type: String
        },

        gridModel: {
          type: Object,
          value: function() {
            return[{
              fieldName: 'name'
            }, {
              fieldName: 'value'
            }, {
              fieldName: 'fileSize'
            }, {
              fieldName: 'mimeType'
            }, {
              fieldName: 'creator'
            }, {
              fieldName: 'createdAt'
            }]
          }
        },

        gridColumns: {
          type: Object,
          value: function() {
            return [{
              fieldName: 'Name'
            }, {
              fieldName: 'File Size'
            }, {
              fieldName: 'Mime-Type'
            }, {
              fieldName: 'Created By'
            }, {
              fieldName: 'Created At'
            }]
          }
        },

        queryFields: {
          type: Array,
          value: function() {
            return [{
              name: 'onType',
              operator: 'eq',
              value: 'Alarm'
            }, {
              name: 'onId',
              operator: 'eq',
              value: '1'
            }]
          }
        },

        /**
         * Grid Search URL
         */
        gridSearchUrl: {
          type: String,
          value: function() {
            return 'attachments';
          }
        }
      },

      listeners: {
        'grid.things-grid-detail-tap': '_showResourceForm',
        'grid.things-grid-resource-column-edit': '_openResourceSelector'
      },

      generateRequest: function() {
        this.$.resourceSearch.generateRequest();
      }
      
    });
  </script>
</dom-module>