<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../things-resource/things-resource.html">
<!--
A comment describing this element

Example:

    <my-elem></my-elem>

Example:

    <my-elem>
      <h2>Hello my-elem</h2>
    </my-elem>

@demo demo/index.html
-->

<dom-module id="things-content">
	<template>
		<style>
			:host {
				display: block;
				height: 100%;
			}
		</style>

		<div class="[[layout]]">

			<things-resource 
				auto
				action="[[searchFieldUrl]]" 
				output-data="{{searchFields}}">
			</things-resource>

			<things-form 
				title="[[title]]"
				search-fields ="[[searchFields]]" 
				action="{{searchDataUrl}}" 
				method="GET"
				content-type="application/json"
				output="{{gridData}}"
				class="flex">
			</things-form>

			<things-resource 
				auto
				action="[[gridFieldUrl]]" 
				output-data="{{gridFields}}">
			</things-resource>

			<things-resource 
				auto
				action="[[gridColumnUrl]]" 
				output-data="{{gridColumns}}">
			</things-resource>

			<things-grid 
				id="grid"
				fields ="[[gridFields]]" 
				columns="[[gridColumns]]" 
				input="[[gridData]]"
				class="flex"
				selected-row-data="{{selectedRow}}"
				output="{{gridOuput}}">
			</things-grid>
			<things-resource-form 
				id="dialog"
				view="{{resView}}" 
				input="{{selectedRow}}">
			</things-resource-form>
		</div>

	</template>

	<script>
		Polymer({
			is: 'things-content',

			behaviors: [ ThingsGlobalBehavior ],
			
			properties: {
				layout: {
					type: String
				},
				searchFieldUrl: {
					type: String
				},
				searchActionUrl: {
					type: String
				},
				searchDataUrl: {
					computed: 'computeSearchUrl(globals.basicUrl,searchActionUrl)'
				},
				gridFieldUrl: {
					type: String
				},
				gridColumnUrl: {
					type: String
				},
				gridOuput: {
					type: Object
				},
				gridColumns: {
					type: Array
				},
				gridFields: {
					type: Array
				},
				gridData: {
					type: Array
				},
				selectedRow:{
					type:Object,
					observer:'_onSelectedRowChange'
				}
			},

			computeSearchUrl: function(basicUrl, searchActionUrl) {
				return basicUrl + '/' + searchActionUrl;
			},
			// Event listener
			listeners : {
				'grid.on-detail-clicked': '_openDialog'
			},
			_onSelectedRowChange:function(){
				if(this.selectedRow){
					var keys = Object.keys(this.selectedRow);
					console.log(keys);
					// for(index in keys){
					// 	var element.name = keys[index];
					// 	element.label = keys[index].charAt(0).toUpperCase() + string.slice(1);
					// 	var data = selectedRow[keys[index]];
					// 	element.type = typeof data;
					// }
				}
			},
			_openDialog:function(row,grid){
				this.$.dialog.open();
			}


		});
	</script>
</dom-module>