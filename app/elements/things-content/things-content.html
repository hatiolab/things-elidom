<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../../bower_components/iron-iconset/iron-iconset.html">
<link rel="import" href="../../../bower_components/iron-iconset-svg/iron-iconset-svg.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../things-button/things-button.html">
<link rel="import" href="../things-form/things-resource-form.html">
<link rel="import" href="../things-form/things-search-form.html">
<link rel="import" href="../things-grid/things-grid.html">
<link rel="import" href="../things-resource/things-resource.html">
<link rel="import" href="../things-paginator/things-paginator.html">

<!--
A comment describing this element

Example:

    <my-elem></my-elem>

Example:

    <my-elem>
      <h2>Hello my-elem</h2>
    </my-elem>

@demo demo/index.html
-->

<dom-module id="things-content">
	<template>
		<style>
			:host {
				display: block;
				height: 100%;
			}
		</style>

		<div class="[[layout]]">
			<things-resource 
				auto
				action="[[searchFieldUrl]]" 
				output-data="{{searchFormFields}}">
			</things-resource>

			<things-search-form 
				class="flex"
				title="[[title]]"
				form-fields="[[searchFormFields]]" 
				action="{{searchActionUrl}}" 
				method="GET"
				content-type="application/json"
				output="{{gridData}}"
				page="{{page}}"
				limit="{{limit}}"
				total-count="{{totalCount}}">
			</things-search-form>

			<things-resource 
				auto
				action="[[gridFieldUrl]]" 
				output-data="{{gridFields}}">
			</things-resource>

			<things-resource 
				auto
				action="[[gridColumnUrl]]" 
				output-data="{{gridColumns}}">
			</things-resource>

			<things-grid 
				id="grid"
				class="flex"
				fields="[[gridFields]]" 
				columns="[[gridColumns]]" 
				input="[[gridData]]"
				root-property="items"
				total-property="total"
				selected-row-data="{{selectedRow}}"
				output="{{gridOuput}}"
				page="{{page}}"
				limit="{{limit}}"
				total-count="{{totalCount}}">
			</things-grid>

			<things-resource-form 
				id="dialog"
				title="Item Detail"
				form-fields="{{resourceFormFields}}" 
				input="{{selectedRow}}"

				action="">
			</things-resource-form>
		</div>
	</template>

	<script>
		Polymer({
			is: 'things-content',

			behaviors: [ ThingsGlobalBehavior ],
			
			properties: {
				layout: {
					type: String
				},
				searchFieldUrl: {
					type: String
				},
				searchActionUrl: {
					type: String
				},
				gridFieldUrl: {
					type: String
				},
				gridColumnUrl: {
					type: String
				},
				gridOuput: {
					type: Object
				},
				gridColumns: {
					type: Array
				},
				gridFields: {
					type: Array
				},
				gridData: {
					type: Array
				},
				selectedRow: {
					type: Object,
					observer: '_onSelectedRowChange'
				}
			},

			listeners : {
				'grid.on-detail-clicked': '_openDialog'
			},			
			
			_onSelectedRowChange: function() {
				if(this.selectedRow) {
					var view = [];
					var keys = Object.keys(this.selectedRow);

					for(index in keys) {
						var element = {};
						element.name = keys[index];
						element.label = keys[index].charAt(0).toUpperCase() + keys[index].slice(1);
						var data = this.selectedRow[keys[index]];
						element.type = (typeof data)=='undefined'?'string':(typeof data);
						element.type = element.type=='string'?'text':element.type;
						view.push(element);
					}
					
					if(view && view.length > 0) {
						this.resourceFormFields = view;
					}
				}
			},

			/**
			 * open resource form dialog
			 */
			_openDialog: function(row, grid) {
				this.$.dialog.open();
			}

		});
	</script>
</dom-module>