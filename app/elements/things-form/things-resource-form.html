<link rel="import" href="./things-form-behavior.html">
<link rel="import" href="../../../bower_components/paper-fullscreen-dialog/paper-fullscreen-dialog.html">

<link rel="import" href="./things-form-behavior.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../../bower_components/iron-iconset/iron-iconset.html">
<link rel="import" href="../../../bower_components/iron-iconset-svg/iron-iconset-svg.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<!--
A comment describing this element

Example:

	<my-elem></my-elem>

Example:

	<my-elem>
	  <h2>Hello my-elem</h2>
	</my-elem>

@demo demo/index.html
-->

<dom-module id="things-resource-form">
	<template>
		<style is="custom-style" include="iron-flex iron-flex-alignment">
		<style>
			:host {
				display: block;
				box-sizing: border-box;
				/*text-align: center;*/
				/*margin: 0 auto;*/
				height: 100%;
				width: 98%;
			}

			:host > h3 {
				margin-top: 5px;
			}

			:host::content img {
				border-radius: 50%;
			}

			:host paper-input {
				margin-left: auto;
				margin-right: auto;
				width: 90%;
			}

			:host paper-material {
				padding: 15px;
			}

			:host .search {
				padding:5px 0 3px 5px;
			}

			:host .search paper-button {
				width:22px;height:22px;
				margin-left:3px;
				padding:1px;
			}
		</style>

		<paper-fullscreen-dialog
			id="resourceDialog"
			modal = "true"
			dismiss-icon="close"
			>
			<!-- <paper-icon-button icon="close" affirmative dialog-dismiss></paper-icon-button> -->
			<h2>{{title}}</h2>
			<paper-button affirmative dialog-confirm on-tap="save">Save</paper-button>
			<form 	is="iron-form" 
					id="resourceForm" 
					action=[[action]]
					headers="[[headers]]"
					content-type="[[contentType]]"
					method="[[method]]"
					last-response ="{{output}}">
				<div class="layout horizontal flex" >
					<div id="leftFields" class="layout vertical flex"></div>
					<div id="rightFields" class="layout vertical flex"></div>
				</div>
			</form>
		</paper-fullscreen-dialog>
	</template>

	<script>
		Polymer({
			is: 'things-resource-form',
			
			properties: {
				title: String
			},
			detached:function(){

			},
			/**
			 * view atrribute observer, add view to form
			 */
			buildFormView: function() {
				for(index in this.formFields) {
					var field = this.formFields[index];
					var newElement = this._generateElement(field);

					if((index % 2) == 0) {
						this.$.leftFields.appendChild(newElement);
					} else {
						this.$.rightFields.appendChild(newElement);
					}
				}
			},

			behaviors: [
				ThingsFormBehavior,
				Polymer.IronResizableBehavior
			],
			listeners : {
				'resourceDialog.iron-overlay-closed': 'clearForm',
				'resourceDialog.iron-overlay-canceled': 'clearForm',
				'resourceDialog.iron-overlay-opened': 'openForm',
				'iron-resize': 'onIronResize'
			},
			/**
			 * save data from resource detail screen
			 */
			save: function() {
				this.method ='post';
				this._submitForm();
			},

			/**
			 * open dialog
			 */
			open: function() {
				this.$.resourceDialog.toggle();
			},
			onIronResize:function(){
				this.$.resourceForm.style.width = this.parentNode.offsetWidth + 'px';
			},
			clearForm :function(){
				var i = 0;
				while(this.$.leftFields.childNodes.length>0
					  ||this.$.rightFields.childNodes.length>0)
				{
					if(this.$.leftFields.childNodes[0])
						this.$.leftFields.removeChild(this.$.leftFields.childNodes[0]);
					if(this.$.rightFields.childNodes[0])
						this.$.rightFields.removeChild(this.$.rightFields.childNodes[0]);
				}
			},
			openForm :function(){
				this.$.resourceDialog.refit();
				this.fire('resource-form-opened',this.$.resourceForm,this.$.resourceDialog);
			}
		});
	</script>

</dom-module>