<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/iron-input/iron-input.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../../bower_components/paper-input/paper-textarea.html">

<link rel="import" href="./things-form-behavior.html">

<!--
A things login form asking for login and password.

Example:

<things-form data-route="form">
</things-form>

@demo demo/index.html
-->

<dom-module id="things-search-form">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment">
    <style>
    :host {
      display: block;
      box-sizing: border-box;
      /*text-align: center;*/
      /*margin: 0 auto;*/
      height: 100%;
      width: 98%;
    }
        
    :host paper-input {
      margin-left: auto;
      margin-right: auto;
      width: 90%;
    }

    :host things-code-selector {
      margin-left: auto;
      margin-right: auto;
      width: 90%;
    }    
    
    :host paper-material {
      padding: 15px;
    }

    :host .search {
      padding:5px 0 3px 5px;
    }

    :host .fields {
      padding: 0px 10px 0px 0px;
    }
    
    </style>

    <paper-material elevation="1" class="flex" on-keypress="_keyPressHandler">
      <paper-toolbar>
        <paper-icon-button icon="menu"></paper-icon-button>
        <span class="title">{{title}}</span>
        <paper-icon-button icon="search" id="searchBtn" on-click="_submitForm"></paper-icon-button>
        <paper-icon-button icon="refresh" id="resetBtn" on-click="_resetForm"></paper-icon-button>
        <paper-tooltip for="searchBtn" offset="0">Search</paper-tooltip>
        <paper-tooltip for="resetBtn" offset="0">Reset</paper-tooltip>
      </paper-toolbar>

      <div class="layout vertical flex">
        <form is="iron-form" 
              id="searchForm" 
              action=[[actionUrl]]
              headers="[[headers]]"
              content-type="[[contentType]]"
              method="[[method]]"
              last-response ="{{output}}">

          <div class="layout horizontal flex" >
            <div id="leftFields" class="layout vertical flex fields"></div>
            <div id="rightFields" class="layout vertical flex"></div>
          </div>
        </form>
      </div>
    </paper-material>
  </template>

  <script>
  Polymer({

    is: 'things-search-form',

    properties: {
      page : {
        type: Number,
        value: 1,
        notify: true,
        observer: 'pageChanged'
      },

      limit: {
        type: Number,
        value: 50,
        notify: true
      },

      totalCount: {
        type: Number
      }
    },
    
    behaviors: [ ThingsFormBehavior ],

    listeners : {
      'iron-form-presubmit' :'preSubmitHandler'
    },    

    /**
     * build form view - add child element dynamically
     */
    buildFormView: function() {
      if(this.formFields.length > 0) {
        for(index in this.formFields) {
          var field = this.formFields[index];
          var newElement = this._generateElement(field);

          if((index % 2) == 0) {
            this.$.leftFields.appendChild(newElement);
          } else {
            this.$.rightFields.appendChild(newElement);
          }
        }
      }
    },

    /**
     * submit form 전에 파라미터 변경 ...
     */
    preSubmitHandler: function(e) {
      var form = this._getForm();
      form.request.params || {};
      form.request.params.page = this.page;
      form.request.params.limit = this.limit;
    },

    /**
     * refresh when current page changed
     */
    pageChanged: function(page) {
      if(this.totalCount > 0 && page > 0) {
        this._submitForm();
      }
    }

  });
  </script>
</dom-module>
